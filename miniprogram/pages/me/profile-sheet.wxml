<!-- 个人资料底部弹窗 -->
<ui-drawer 
  title="{{ui.userProfileTitle}}" 
  show="{{showProfileSheet}}" 
  bind:close="closeProfileSheet" 
  bind:confirm="onProfileConfirm"
  confirmText="{{ui.confirm}}"
>
  <view class="bottom-sheet-content profile-sheet-content">
    <!-- Upload Avatar - 独立一栏，左右布局 -->
    <view class="profile-avatar-section" catchtap="onUploadAvatar">
      <text class="profile-avatar-title">{{ui.uploadAvatar}}</text>
      <view class="profile-avatar-content">
        <block wx:if="{{userInfo}}">
          <view class="profile-avatar-wrapper profile-avatar-bordered">
            <image class="profile-avatar-preview" src="{{userInfo.avatar}}" mode="aspectFill"/>
          </view>
        </block>
        <block wx:else>
          <view class="profile-avatar-wrapper profile-avatar-bordered">
            <view class="profile-avatar-placeholder"></view>
          </view>
        </block>
      </view>
    </view>

    <!-- Edit Nickname & Phone Number - 合并到一个card -->
    <view class="profile-info-section">
      <!-- Edit Nickname -->
      <view class="profile-info-item">
        <view class="profile-nickname-header">
          <text class="profile-nickname-title">{{ui.editNickname}}</text>
          <view class="profile-nickname-change-btn" catchtap="onEditNickname">
            <text class="profile-nickname-change-btn-text">{{ui.changePhone}}</text>
          </view>
        </view>
        <view class="profile-nickname-content">
          <text class="profile-nickname-value">{{userInfo ? userInfo.nickName : ui.notSet}}</text>
        </view>
      </view>

      <!-- Phone Number -->
      <view class="profile-info-item">
        <view class="profile-phone-header">
          <text class="profile-phone-title">{{ui.phoneNumber}}</text>
          <ui-button
                  wx:if="{{!userPhone}}"
                  type="outline"
                  size="sm"
                  openType="getPhoneNumber"
                  bind:getphonenumber="onChangePhoneNumber"
          >
            {{ui.setPhone}}
          </ui-button>
        </view>
        <view class="profile-phone-content">
          <text class="profile-phone-value">{{userPhone ? maskedPhone : ui.notSet}}</text>
        </view>
      </view>
    </view>
  </view>
</ui-drawer>

<!-- Edit Nickname Modal -->
<block wx:if="{{showNicknameModal}}">
  <view class="nickname-modal-mask {{nicknameModalOpen ? 'nickname-modal-mask-open' : ''}}" catchtap="closeNicknameModal"></view>
  <view class="nickname-modal {{nicknameModalOpen ? 'nickname-modal-open' : ''}}">
    <view class="nickname-modal-header">
      <text class="nickname-modal-title">{{ui.editNickname}}</text>
    </view>
    <view class="nickname-modal-body">
      <input
              class="nickname-modal-input"
              type="text"
              value="{{newNickname}}"
              bindinput="onNicknameInput"
              maxlength="20"
              placeholder="{{ui.editNickname}}"
              focus="{{nicknameModalOpen}}"
              confirm-type="done"
              bindconfirm="onSaveNickname"
      />
    </view>
    <view class="nickname-modal-footer">
      <ui-button type="secondary" size="md" bindtap="onCancelEditNickname" custom-class="nickname-modal-cancel">
        {{ui.cancel}}
      </ui-button>
      <ui-button type="primary" size="md" bindtap="onSaveNickname" custom-class="nickname-modal-save">
        {{ui.save}}
      </ui-button>
    </view>
  </view>
</block>
