<!--miniprogram/pages/resume-profile/index.wxml-->
<view class="page">
  <view class="header-section">
    <view class="title-row">
      <text class="page-title">{{ui.title}}</text>
    </view>
    <view class="tips-card">
      <image class="tips-icon" src="../../assets/icons/four-pointed-start.png" mode="aspectFit" />
      <text class="tips-text">{{ui.tips}}</text>
    </view>
  </view>

  <scroll-view     
    class="resume-content" 
    scroll-y="{{true}}"
    enhanced="true" 
    show-scrollbar="{{false}}"
  >
    <view class="resume-body">
      <!-- 基本信息 -->
      <view class="section-group">
        <view class="section-group-title">{{ui.personalInfo}}</view>
        <view class="card">
          <!-- 照片 -->
          <view class="list-item photo-item" bindtap="onEditPhoto">
            <view class="item-label">{{ui.photo}}</view>
            <view class="item-value">
              <block wx:if="{{photo}}">
                <image class="avatar-img" src="{{photo}}" mode="aspectFill"></image>
              </block>
              <block wx:else>
                <view class="avatar-placeholder"></view>
              </block>
              <view class="arrow-icon"></view>
            </view>
          </view>
          
          <!-- 个人姓名 -->
          <view class="list-item" bindtap="onEditName">
            <view class="item-label">{{ui.name}}</view>
            <view class="item-value">
              <text class="{{name ? 'value-text' : 'placeholder-text'}}">{{name || ui.noData}}</text>
              <view class="arrow-icon"></view>
            </view>
          </view>
        </view>
      </view>

      <!-- 联系方式 -->
      <view class="section-group">
        <view class="section-group-title">{{ui.contactInfo}}</view>
        <view class="card">
          <view class="list-item" bindtap="onEditWechat">
            <view class="item-label">{{ui.wechat}}</view>
            <view class="item-value">
              <text class="{{wechat ? 'value-text' : 'placeholder-text'}}">{{wechat || ui.noData}}</text>
              <view class="arrow-icon"></view>
            </view>
          </view>
          
          <view class="list-item" bindtap="onEditEmail">
            <view class="item-label">{{ui.email}}</view>
            <view class="item-value">
              <text class="{{email ? 'value-text' : 'placeholder-text'}}">{{email || ui.noData}}</text>
              <view class="arrow-icon"></view>
            </view>
          </view>
          
          <view class="list-item" bindtap="onEditPhone">
            <view class="item-label">{{ui.phone}}</view>
            <view class="item-value">
              <text class="{{phone ? 'value-text' : 'placeholder-text'}}">{{phone || ui.noData}}</text>
              <view class="arrow-icon"></view>
            </view>
          </view>
        </view>
      </view>

      <!-- 毕业院校 -->
      <view class="section-group">
        <view class="section-header-row">
          <view class="section-group-title">{{ui.education}}</view>
          <view class="add-btn" bindtap="onAddEducation">
            <text class="add-btn-text">{{ui.addEducation}}</text>
          </view>
        </view>
        
        <view class="card education-card">
          <block wx:if="{{educations && educations.length > 0}}">
            <view class="education-item" wx:for="{{educations}}" wx:key="index" bindtap="onEditEducation" data-index="{{index}}">
              <view class="edu-info">
                <view class="edu-school">{{item.school || ui.noData}}</view>
                <view class="edu-details">
                  <text wx:if="{{item.degree}}">{{item.degree}}</text>
                  <text wx:if="{{item.degree && item.major}}"> · </text>
                  <text wx:if="{{item.major}}">{{item.major}}</text>
                </view>
                <view class="edu-date" wx:if="{{item.startDate || item.endDate || item.graduationDate}}">
                  {{item.startDate || ''}} - {{item.endDate || item.graduationDate || ''}}
                </view>
              </view>
              <view class="arrow-icon"></view>
            </view>
          </block>
          <block wx:else>
            <view class="empty-state" bindtap="onAddEducation">
              <text class="empty-text">{{ui.noData}}</text>
            </view>
          </block>
        </view>
      </view>

      <!-- 证书 -->
      <view class="section-group">
        <view class="section-header-row">
          <view class="section-group-title">{{ui.certificates}}</view>
          <view class="add-btn" bindtap="onAddCertificate">
            <text class="add-btn-text">{{ui.addCertificate}}</text>
          </view>
        </view>
        
        <view class="tags-wrapper">
          <block wx:if="{{certificates && certificates.length > 0}}">
            <view class="tag-item" wx:for="{{certificates}}" wx:key="index" bindtap="onEditCertificate" data-index="{{index}}">
              <text class="tag-text">{{item}}</text>
              <view class="tag-del" catchtap="onDeleteCertificate" data-index="{{index}}">×</view>
            </view>
          </block>
          <block wx:else>
            <view class="empty-tags" bindtap="onAddCertificate">
              <text class="empty-text">{{ui.noData}}</text>
            </view>
          </block>
        </view>
      </view>
      
      <view class="bottom-safe-area"></view>
    </view>
  </scroll-view>

  <!-- 教育经历编辑弹窗 (右侧弹出) -->
  <view class="drawer-mask {{showEduDrawer ? 'drawer-mask-show' : ''}}" bindtap="closeEduDrawer"></view>
  <view class="drawer {{showEduDrawer ? 'drawer-show' : ''}}">
    <view class="drawer-header">
      <text class="drawer-title">{{editingEduIndex === -1 ? ui.addEducation : ui.education}}</text>
      <view wx:if="{{editingEduIndex !== -1}}" class="header-delete" bindtap="onDeleteEducation">
        <text>{{ui.delete}}</text>
      </view>
    </view>
    
    <view class="drawer-content">
      <view class="form-item">
        <text class="form-label">{{ui.education}}</text>
        <input class="form-input" placeholder="{{ui.schoolPlaceholder}}" value="{{eduForm.school}}" bindinput="onEduSchoolInput" />
      </view>

      <view class="form-item">
        <text class="form-label">{{ui.degree}}</text>
        <view class="picker-value {{eduForm.degree ? '' : 'placeholder-text'}}" bindtap="openDegreePicker">
          {{eduForm.degree || ui.degreePlaceholder}}
        </view>
      </view>

      <view class="form-item">
        <text class="form-label">{{ui.major}}</text>
        <input class="form-input" placeholder="{{ui.majorPlaceholder}}" value="{{eduForm.major}}" bindinput="onEduMajorInput" />
      </view>

      <view class="form-item">
        <text class="form-label">{{ui.timePeriod}}</text>
        <view class="date-range-row">
          <view class="picker-value {{eduForm.startDate ? '' : 'placeholder-text'}}" bindtap="openDatePicker" data-field="startDate">
            {{eduForm.startDate || ui.startDate}}
          </view>
          <text class="date-sep">-</text>
          <view class="picker-value {{eduForm.endDate ? '' : 'placeholder-text'}}" bindtap="openDatePicker" data-field="endDate">
            {{eduForm.endDate || ui.endDate}}
          </view>
        </view>
      </view>

      <view class="form-item">
        <text class="form-label">{{ui.description}} <text class="optional-hint">({{ui.optional}})</text></text>
        <textarea 
          class="form-textarea" 
          placeholder="{{ui.descriptionPlaceholder}}" 
          value="{{eduForm.description}}" 
          bindinput="onEduDescriptionInput"
          maxlength="500"
          auto-height
        />
      </view>
    </view>

    <view class="drawer-footer">
      <view class="btn-secondary" bindtap="closeEduDrawer">
        <text>{{ui.cancel}}</text>
      </view>
      <view class="btn-primary" bindtap="onSaveEducation">
        <text>{{ui.save}}</text>
      </view>
    </view>
  </view>

  <!-- 自定义学历选择器 (底部弹出) -->
  <view class="picker-mask {{showDegreePicker ? 'picker-mask-show' : ''}}" bindtap="closeDegreePicker"></view>
  <view class="custom-picker {{showDegreePicker ? 'custom-picker-show' : ''}}">
    <view class="custom-picker-header">
      <view class="custom-picker-cancel" bindtap="closeDegreePicker">{{ui.cancel}}</view>
      <text class="custom-picker-title">{{ui.degreePlaceholder}}</text>
      <view class="custom-picker-confirm" bindtap="onConfirmDegree">{{ui.save}}</view>
    </view>
    <view class="picker-view-container">
      <picker-view 
        indicator-style="height: 100rpx;" 
        style="width: 100%; height: 450rpx;" 
        value="{{degreePickerValue}}" 
        bindchange="onDegreePickerChange"
      >
        <picker-view-column>
          <view wx:for="{{degreeOptions}}" wx:key="*this" class="picker-column-item">{{item}}</view>
        </picker-view-column>
        <picker-view-column>
          <view wx:for="{{studyTypes}}" wx:key="*this" class="picker-column-item">{{item}}</view>
        </picker-view-column>
      </picker-view>
    </view>
  </view>

  <!-- 自定义年月选择器 (底部弹出) -->
  <view class="picker-mask {{showDatePicker ? 'picker-mask-show' : ''}}" bindtap="closeDatePicker"></view>
  <view class="custom-picker {{showDatePicker ? 'custom-picker-show' : ''}}">
    <view class="custom-picker-header">
      <view class="custom-picker-cancel" bindtap="closeDatePicker">{{ui.cancel}}</view>
      <text class="custom-picker-title">{{currentDatePickingField === 'startDate' ? ui.startDate : ui.endDate}}</text>
      <view class="custom-picker-confirm" bindtap="onConfirmDate">{{ui.save}}</view>
    </view>
    <view class="picker-view-container">
      <picker-view 
        indicator-style="height: 100rpx;" 
        style="width: 100%; height: 450rpx;" 
        value="{{datePickerValue}}" 
        bindchange="onDatePickerChange"
      >
        <picker-view-column>
          <view wx:for="{{years}}" wx:key="*this" class="picker-column-item">{{item}}年</view>
        </picker-view-column>
        <picker-view-column>
          <view wx:for="{{months}}" wx:key="*this" class="picker-column-item">{{item}}月</view>
        </picker-view-column>
      </picker-view>
    </view>
  </view>
</view>

