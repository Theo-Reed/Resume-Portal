<!-- Remote jobs list page -->
<view class="page">
  <view class="page-header">
    <!-- title removed -->
    <view class="filter-toggle" bindtap="toggleFilter">
      <text class="filter-label">{{currentFilter}}</text>
      <view class="filter-triangle {{showFilter ? 'filter-triangle-up' : ''}}" />
    </view>
  </view>

  <view class="search-bar">
    <input
      class="search-input"
      type="text"
      placeholder="搜索职位名称或来源.."
      placeholder-class="search-placeholder"
      confirm-type="search"
      value="{{searchKeyword}}"
      bindinput="onSearchInput"
    />

    <view class="search-actions">
      <view class="search-pill" bindtap="toggleFilter">
        <text class="search-pill-text">{{currentFilter}}</text>
        <view class="search-pill-triangle {{showFilter ? 'search-pill-triangle-up' : ''}}" />
      </view>

      <view class="search-pill" bindtap="toggleDrawer">
        <text class="search-pill-text">筛选</text>
        <view class="search-pill-triangle" />
      </view>
    </view>
  </view>

  <!-- Drawer Component -->
  <drawer
    show="{{showDrawer}}"
    value="{{drawerFilter}}"
    bind:close="toggleDrawer"
    bind:confirm="onDrawerConfirm"
    bind:reset="onDrawerReset"
    bind:openFavorites="openFavoritesSheet"
  />

  <!-- Job Detail Drawer Component -->
  <job-detail
    id="jobDetail"
    show="{{showJobDetail}}"
    job-id="{{selectedJobId}}"
    collection="{{selectedCollection}}"
    bind:close="closeJobDetail"
  />

  <!-- 遮罩层：点击非弹窗区域时关闭弹窗 -->
  <view wx:if="{{showFilter}}" class="filter-mask" bindtap="toggleFilter"></view>

  <view wx:if="{{showFilter}}" class="filter-dropdown" catchtap="stopPropagation">
    <block wx:for="{{filterOptions}}" wx:key="*this">
      <view class="filter-option" data-value="{{item}}" bindtap="onSelectFilter">
        <text>{{item}}</text>
      </view>
    </block>
  </view>

  <job-list
    jobs="{{filteredJobs}}"
    loading="{{loading}}"
    show-no-more="{{!hasMore && filteredJobs.length > 0}}"
    no-more-visible="{{showNoMore}}"

    scroll-y="{{isScrollable}}"
    scroll-top="{{scrollTop}}"
    lower-threshold="{{lowerThreshold}}"
    scroll-with-animation="{{true}}"
    enhanced="{{true}}"
    show-scrollbar="{{false}}"
    enable-back-to-top="{{false}}"
    enable-passive="{{true}}"

    enable-detail="{{true}}"
    detail-selector="#jobDetail"
    detail-collection-fallback="{{selectedCollection}}"

    bind:itemtap="onJobTap"
    bind:scrolltolower="onScrollLower"
    bind:scroll="onScroll"
    bind:touchstart="onTouchStart"
    bind:touchend="onTouchEnd"
  />

</view>
